<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100" height="100" backgroundColor="#000000">
	
	<mx:Label horizontalCenter="0" verticalCenter="0" color="#FFFFFF" text="{char.name}"/>
	
	<mx:Script>
		<![CDATA[
			import bombs.model.Character;
			[Bindable] private var char:Character;
			
			override public function set data(value:Object):void
			{
				super.data = value;
				char = value as Character;
			}
			
			private var destChanged:Boolean = false;
			private function set dest(value:*):void
			{
				destChanged = true;
				invalidateProperties();
			}
			
			override protected function commitProperties():void
			{
				super.commitProperties();

				if (destChanged)
				{
					destChanged = false;
					
					moveChar.pause();
					
					animateX.fromValue = this.x;
					animateX.toValue = char.destinationX;
					
					animateY.fromValue = this.y;
					animateY.toValue = char.destinationY;
					
					moveChar.play();
				}				
			}

			// Update the server with my location once I'm done moving. 			
			private function onMoved():void
			{
				return;
			}
		]]>
	</mx:Script>
	
	<mx:Binding source="char.destinationX" destination="dest"/>
	<mx:Binding source="char.destinationY" destination="dest"/>
		
	<mx:Parallel id="moveChar" target="{this}" effectEnd="onMoved()">
		<mx:AnimateProperty id="animateX" property="x"/>
		<mx:AnimateProperty id="animateY" property="y"/>
	</mx:Parallel>
	
</mx:VBox>
